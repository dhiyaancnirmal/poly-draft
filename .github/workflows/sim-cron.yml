name: Simulated League Jobs

on:
  schedule:
    # Run every 5 minutes
    - cron: "*/5 * * * *"
  workflow_dispatch:
    inputs:
      job:
        description: 'Job to run'
        required: false
        default: 'all'
        type: choice
        options:
          - all
          - refresh-prices
          - score
          - resolutions

env:
  BASE_URL: https://poly-draft-ypzk.vercel.app

jobs:
  refresh-prices:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'schedule' || github.event.inputs.job == 'all' || github.event.inputs.job == 'refresh-prices' }}
    steps:
      - name: Refresh prices
        run: |
          echo "Refreshing prices..."
          curl -sf -X POST "$BASE_URL/api/leagues/simulated/jobs/refresh-prices" \
            -H "Content-Type: application/json" \
            --max-time 30 || echo "Request failed or timed out"

  score:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'schedule' || github.event.inputs.job == 'all' || github.event.inputs.job == 'score' }}
    steps:
      - name: Score leagues
        run: |
          echo "Scoring leagues..."
          curl -sf -X POST "$BASE_URL/api/leagues/simulated/jobs/score" \
            -H "Content-Type: application/json" \
            --max-time 30 || echo "Request failed or timed out"

  resolutions:
    runs-on: ubuntu-latest
    if: ${{ github.event_name == 'schedule' || github.event.inputs.job == 'all' || github.event.inputs.job == 'resolutions' }}
    steps:
      - name: Process resolutions
        run: |
          echo "Processing resolutions..."
          curl -sf -X POST "$BASE_URL/api/leagues/simulated/jobs/resolutions" \
            -H "Content-Type: application/json" \
            --max-time 30 || echo "Request failed or timed out"
